# MiKo_5012: Do not use `yield return` for recursively defined structures

## Cause

A method that uses `yield return` calls itself recursively.

## Rule description

To improve performance, avoid letting methods with yield call themselves recursively.
This causes the underlying iterators to be called more times than expected, resulting in poor runtime performance.

### Rationale behind

When a method uses `yield return`, the compiler generates a state machine that implements the iterator pattern.
Each call to a yielding method creates a new instance of this state machine.
When such a method calls itself recursively, each level of recursion creates a new state machine, and the caller must iterate through all these nested state machines.

This creates a chain of iterators where each item must pass through multiple layers before reaching the caller, causing significant performance degradation.

Avoiding recursive yield methods provides important benefits:

- **Reduced Iterator Overhead**:
  Each level of recursion creates a new iterator state machine.
  The result is a chain of iterators that each item must pass through, multiplying the overhead.

- **Better Performance**:
  Iterating through deeply nested structures with recursive yield can be orders of magnitude slower than using a queue or stack-based approach.
  The overhead of managing multiple state machines compounds with recursion depth.

- **Predictable Memory Usage**:
  Recursive yield methods keep all the iterator state machines alive until iteration completes.
  This can consume significant memory for deep recursion.
  Iterative approaches have more predictable memory usage.

- **Easier Debugging**:
  Stack traces for recursive yield methods can be confusing because they involve compiler-generated state machine code.
  Iterative implementations are easier to debug and understand.

- **Simpler Code Flow**:
  While recursive algorithms can be elegant, recursive yield methods hide complexity in the state machine.
  Using a queue or stack explicitly makes the algorithm easier to understand and maintain.

## How to fix violations

To fix a violation of this rule, refactor the recursive method to use an explicit stack or queue instead of recursion.

## How to suppress violations

```csharp
#pragma warning disable MiKo_5012
#pragma warning restore MiKo_5012
```

## Additional information
For more information, see this discussion on [Stack Overflow](https://stackoverflow.com/questions/3969963/when-not-to-use-yield-return).