# MiKo_3022: Do not return `Task<IEnumerable>` or `Task<IEnumerable<T>>`

## Cause

A method returns `Task<IEnumerable>` or `Task<IEnumerable<T>>`.

## Rule description

If a method returns `Task<IEnumerable>` or `Task<IEnumerable<T>>`, the enumerable is likely not evaluated until accessed in a foreach or LINQ call.
This evaluation likely occurs on another thread (e.g., the main thread), which contradicts the idea of returning a dedicated task.

### Rationale behind

Returning Task with unevaluated enumerables creates deferred execution that defeats the purpose of asynchronous operations.
The task completes before the actual work is done, moving execution to the calling thread.

Avoiding Task with IEnumerable return types provides several important benefits:

- **Predictable Async Behavior**:
  Tasks should complete when the work is done.
  Returning unevaluated enumerables means the task completes before enumeration occurs.

- **Correct Thread Usage**:
  The intent of returning a Task is to offload work from the calling thread.
  When enumeration happens on the caller's thread, this intent is defeated.

- **Clearer Performance Characteristics**:
  Developers expect awaiting a task to complete the operation.
  Deferred enumeration creates unexpected performance behavior.

- **Better Error Handling**:
  Errors during enumeration occur outside the task's context.
  This makes exception handling unpredictable and inconsistent.

- **Improved Code Reliability**:
  Materializing collections before returning ensures all processing happens in the async context.
  This prevents threading issues and makes behavior consistent.

## How to fix violations

To fix a violation of this rule, materialize the enumerable (e.g., by calling `.ToList()` or `.ToArray()`) before returning it, or change the return type to `IAsyncEnumerable<T>`.

## How to suppress violations

```csharp
#pragma warning disable MiKo_3022
#pragma warning restore MiKo_3022
```
