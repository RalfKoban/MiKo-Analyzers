# MiKo_3021: Do not use `Task.Run` in implementation

## Cause

Code uses `Task.Run` within a method implementation to wrap operations.

## Rule description

If using `Task.Run` to return a Task for a long-running operation, this is likely a mistake.
Instead, use `Task.Run` to actually call the long-running operation.
This approach aligns better with proper asynchronous programming practices and keeps the code efficient and manageable.

### Rationale behind

Using `Task.Run` within method implementations hides the fact that work is being queued to the thread pool.
This creates [misleading APIs where callers cannot control whether operations run synchronously or asynchronously](https://blog.stephencleary.com/2013/11/taskrun-etiquette-examples-dont-use.html).

Avoiding `Task.Run` in implementations provides several important benefits:

- **Caller Control**:
  Callers should decide whether to use `Task.Run` to offload work to the thread pool.
  When implementations use it internally, callers lose this control.

- **Clearer API Contracts**:
  Method signatures should accurately represent whether operations are truly asynchronous.
  Hiding `Task.Run` inside implementations obscures the actual execution model.

- **Better Performance**:
  `Task.Run` adds overhead by queuing work to the thread pool.
  If the operation is already async, this overhead is unnecessary.

- **Proper Async Patterns**:
  Truly asynchronous operations should use async/await throughout.
  `Task.Run` is appropriate for calling synchronous code from async contexts, not for implementing async methods.

- **Avoids Thread Pool Exhaustion**:
  Excessive use of `Task.Run` can exhaust the thread pool.
  Letting callers control when to use it prevents unintended resource consumption.

## How to fix violations

To fix a violation of this rule, implement the method using proper async/await patterns, or let the caller decide whether to use `Task.Run` to offload the work.

## How to suppress violations

```csharp
#pragma warning disable MiKo_3021
#pragma warning restore MiKo_3021
```
