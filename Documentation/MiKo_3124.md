# MiKo_3124: Do not use assertions in `finally` blocks in test methods

## Cause

A test method contains assertions within a `finally` block.

## Rule description

Avoid asserting in `finally` blocks as failing assertions can hide the original test failures.
Do the assertions after the `finally` blocks to ensure accurate and reliable test results.

### Rationale behind

`finally` blocks execute regardless of whether exceptions occur, which can interfere with proper test failure reporting.
When assertions in `finally` blocks fail, they can mask or override the original test failure, making it difficult to diagnose the actual problem.

This rule provides several important benefits:

- **Preserves Original Failures**:
  If code in the try block fails and then a finally assertion also fails, the finally failure can hide the original problem.
  This makes it harder to identify and fix the root cause.

- **Clearer Failure Messages**:
  When assertions are outside `finally` blocks, test failures clearly indicate what went wrong.
  `finally` block assertions can create confusing failure messages that do not reflect the actual issue.

- **Better Exception Handling**:
  `finally` blocks are meant for cleanup, not validation.
  Mixing assertions with cleanup logic violates the separation of concerns and makes tests harder to understand.

- **Improved Debugging**:
  Developers expect `finally` blocks to contain cleanup code.
  Finding assertions there is unexpected and can complicate debugging efforts.

- **More Reliable Tests**:
  Tests with assertions in the main test body are more straightforward and reliable.
  `finally` block assertions add complexity that can lead to subtle bugs in the test itself.

- **Proper Resource Management**:
  `finally` blocks should focus on releasing resources and cleaning up state.
  Assertions belong in the main test flow where they can be properly evaluated.

## How to fix violations

To fix a violation of this rule, move assertions from `finally` blocks to the main test body, after any necessary cleanup operations.

## How to suppress violations

```csharp
#pragma warning disable MiKo_3124
#pragma warning restore MiKo_3124
```
