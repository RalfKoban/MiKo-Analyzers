# MiKo_3090: Do not throw exceptions in finally blocks

## Cause

A finally block contains code that throws an exception.

## Rule description

Throw exceptions inside try or catch blocks, not within finally blocks.
Finally blocks are meant for cleanup or to ensure certain code runs regardless of other factors.
This maintains their intended purpose and keeps the code clear.

### Rationale behind

Finally blocks have a specific purpose in exception handling: to execute cleanup code that must run regardless of whether an exception was thrown or caught.
Throwing exceptions from finally blocks violates this purpose and can cause serious problems with exception handling.

Avoiding exceptions in finally blocks provides several important benefits:

- **Prevents Exception Masking**:
  If an exception is thrown in a try or catch block and another exception is thrown in the finally block, the original exception is lost.
  This makes debugging extremely difficult because the root cause of the problem is hidden.

- **Maintains Exception Flow**:
  Finally blocks execute after exception handling completes.
  Throwing an exception from a finally block disrupts the expected exception flow and can confuse error handling logic.

- **Preserves Cleanup Guarantees**:
  Finally blocks are meant to guarantee that cleanup happens.
  If a finally block throws an exception, subsequent cleanup code in the same finally block will not execute, potentially leaving resources in an inconsistent state.

- **Follows Language Design Intent**:
  The finally block was designed specifically for cleanup that should not fail.
  Using it to throw exceptions goes against the fundamental design of the try-catch-finally pattern.

- **Improves Error Diagnostics**:
  When exceptions are only thrown from try or catch blocks, debugging and logging capture the actual problem.
  Exceptions from finally blocks often obscure the real issue that needs to be addressed.

- **Supports Proper Resource Management**:
  Cleanup code in finally blocks should handle errors gracefully and log them if necessary, but not propagate them.
  This ensures that all cleanup operations have a chance to complete.

## How to fix violations

To fix a violation of this rule, wrap any code in the finally block that might throw an exception in a try-catch block.
Handle or log exceptions within the finally block instead of allowing them to propagate.
If the exception indicates a serious problem that must be communicated, consider restructuring the code to avoid using a finally block for that operation.

## How to suppress violations

```csharp
#pragma warning disable MiKo_3090
#pragma warning restore MiKo_3090
```
