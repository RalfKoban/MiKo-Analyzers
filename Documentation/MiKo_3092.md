# MiKo_3092: Do not raise events in locks

## Cause

An event is raised within a lock statement.

## Rule description

To avoid deadlocks, do not raise events inside lock statements.
Instead, collect the event handlers and raise the event outside the lock.
This practice ensures smooth and efficient code execution while avoiding potential deadlocks.

### Rationale behind

Raising events inside lock statements creates a dangerous situation where external code (event handlers) executes while holding a lock.
This is one of the most common causes of deadlocks in multithreaded applications because event handlers can attempt to acquire the same or other locks.

Avoiding event raising in locks provides several important benefits:

- **Prevents Deadlocks**:
  Event handlers can execute arbitrary code that might attempt to acquire locks.
  If an event handler tries to acquire the same lock that is currently held, or if it acquires locks in a different order than other threads, a deadlock will occur.

- **Reduces Lock Hold Time**:
  Event handlers can take significant time to execute, especially if they perform I/O operations or complex processing.
  Holding locks while event handlers run increases contention and reduces application throughput.

- **Avoids Reentrancy Issues**:
  Event handlers might call back into the same object that raised the event.
  If the lock is not reentrant or if the object assumes it has exclusive access during the lock, this can cause corruption or exceptions.

- **Improves Performance**:
  Releasing the lock before raising events allows other threads to proceed with their work.
  This reduces thread blocking and improves overall application performance.

- **Simplifies Thread Safety Analysis**:
  When events are raised outside locks, it is easier to reason about thread safety.
  The scope of the lock is clear, and event handlers do not need to be considered when analyzing lock behavior.

- **Enables Better Testing**:
  Code that raises events outside locks is easier to test for thread safety.
  Testing scenarios with event handlers that acquire locks becomes more straightforward.

## How to fix violations

To fix a violation of this rule, capture the event delegate or copy the subscriber list inside the lock.
Release the lock before invoking the captured delegate or invoking each handler from the copied list.
This ensures that event handlers execute outside the lock while still being thread-safe.

## How to suppress violations

```csharp
#pragma warning disable MiKo_3092
#pragma warning restore MiKo_3092
```
