# MiKo_3211: Do not use finalizers in public types

## Cause

A public type contains a finalizer (destructor).

## Rule description

If a public type contains a finalizable resource, use a private nested type (or an internal type for multiple classes) as the finalizable resource holder.

Finalizers are challenging to implement correctly because they cannot assume the state of the system during execution.
This approach ensures proper management of finalizable resources.

### Rationale behind

Finalizers run on a dedicated thread at unpredictable times and cannot make assumptions about the state of the application.
They are difficult to implement correctly and can cause subtle bugs if not handled properly.

Using private nested types for finalizable resources provides several important benefits:

- **Improved Safety**:
  Isolating finalizers to private types reduces the risk of incorrect finalization order.
  The finalizer only manages a specific resource without dependencies on other state.

- **Better Encapsulation**:
  Finalizable resources are hidden from public consumers of the type.
  This prevents misuse and keeps implementation details private.

- **Reduced Complexity**:
  The public type does not need to worry about finalization semantics.
  The complexity is isolated to a small, dedicated type.

- **Enhanced Maintainability**:
  Changes to finalization logic are confined to the resource holder type.
  The public API remains stable and easy to understand.

- **Clearer Responsibility**:
  The private type has a single responsibility: managing the unmanaged resource.
  This follows the Single Responsibility Principle.

- **Prevented Errors**:
  Isolating finalizers prevents common mistakes like accessing managed objects during finalization.
  The pattern enforces correct finalization practices.

## How to fix violations

To fix a violation of this rule, move the finalizer to a private nested type.
Have the private type hold only the unmanaged resource and its finalizer.
Use the private type within the public type through composition.

## How to suppress violations

```csharp
#pragma warning disable MiKo_3211
#pragma warning restore MiKo_3211
```
